<div class="card boundry">
    <div class="card-body">
        <InputFile OnChange="@SelectFile" accept=".funscript" class="form-control mb-3" disabled="@isProcessingFile" />
        @if (isProcessingFile)
        {
            <div class="d-flex justify-content-center align-items-center mb-3">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <span>Processing funscript file...</span>
            </div>
        }
        @if (file != null)
        {
            if (errorMessage == null)
            {
                <div class="mb-3">
                    <strong>File Name:</strong>
                    @file.Name
                </div>
                <div>
                    <strong>File Size:</strong>
                    @file.Size.ToString("N0") bytes
                </div>
                if (funscript != null)
                {
                    <div>
                        <strong>Funscript length:</strong>
                        @funscript.duration
                    </div>
                    <div>
                        <strong>Funscript Actions:</strong>
                        @funscript.number_of_actions.ToString()
                    </div>
                    <div>
                        <strong>Average Speed:</strong>
                        @funscript.GetAverageSpeed().ToString()
                    </div>
                    @* <div>
        <strong>Number of action
        groups:</strong>
        @funscript.GetactionGroupscount().ToString()
        </div> *@

                }

            }
            else
            {
                <p class="text-danger">@errorMessage</p>
            }
        }
    </div>
</div>


@code {

    IBrowserFile? file;
    int MAXFILESIZE = 500000;
    string? errorMessage;
    bool isProcessingFile = false;

    Funscript? funscript;

    [Parameter]
    public EventCallback<Funscript> InputValueChanged
    {
        get;
        set;
    }

    public async Task SelectFile(InputFileChangeEventArgs e)
    {
        file = e.File;
        errorMessage = null;
        isProcessingFile = true;
        StateHasChanged();

        if ((file.Size >= MAXFILESIZE))
        {
            errorMessage = "file too large";
            isProcessingFile = false;
            StateHasChanged();
        }
        else
        {
            try
            {
                funscript = await funscript_manager.DeserializeJsonFile(file);
                funscript_manager.User_Applied_modifier = false;
                Console.WriteLine(funscript.version);
                Console.WriteLine(funscript.video_url);
                Console.WriteLine(funscript.GetAverageSpeed());
                @* funscript.generateActionGroups(); *@
                await InputValueChanged.InvokeAsync(funscript);
            }
            catch (Exception ex)
            {
                errorMessage = $"Error processing file: {ex.Message}";
            }
            finally
            {
                isProcessingFile = false;
                StateHasChanged();
            }
        }
    }
}
